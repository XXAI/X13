<section fxLayout="column" fxLayoutAlign="start" style="height: 100%; overflow: auto; flex: 1 1 0%; background-color: whitesmoke;">
    <section fxFlex="none" class="dashboard-toolbar"> <!-- Toolbar Menu <<<<<<< -->
        <div fxLayout="row">
            <!--button fxFlex="none" mat-button color="default" [matMenuTriggerFor]="menuMovimiento" aria-label="Menu de entrada">
                <mat-icon>settings</mat-icon> Opciones <mat-icon>arrow_drop_down</mat-icon>
            </button-->
            <div fxFlex>
            </div>
            <div fxFlex="none" class="label-info" *ngIf="unidadMedica">
                <span>{{unidadMedica.nombre}}</span>
            </div>
            <div fxFlex="none" fxLayout="column">
                <div fxFlex fxLayout="row" class="dashboard-toolbar-icono">
                    <span fxFlex="none" style="padding-top:2px;"><mat-icon>home_work</mat-icon></span>
                </div>
            </div>
        </div>
        <mat-progress-bar *ngIf="isLoading" mode="indeterminate" [color]="'primary'"></mat-progress-bar>
        <mat-menu #menuMovimiento="matMenu">
            <button mat-menu-item>
                <mat-icon>settings_applications</mat-icon>
                <span>Configurar Firmantes</span>
            </button>
            <button mat-menu-item>
                <mat-icon>border_color</mat-icon>
                <span>Firmar</span>
            </button>
            <button mat-menu-item>
                <mat-icon>outbox</mat-icon>
                <span>Enviar a Revisión</span>
            </button>
            <mat-divider></mat-divider>
            <button mat-menu-item>
                <mat-icon>print</mat-icon>
                <span>Imprimir</span>
            </button>
        </mat-menu>
    </section> <!-- <<<<<<< Toolbar Menu -->
    <div class="data-loading-shade" *ngIf="isLoading"><mat-spinner></mat-spinner></div>
    <section fxFlex fxLayout="row wrap" fxLayoutGap="10px" style="padding: 10px;">
        <div fxFlex="none" fxLayout="column">
            <mat-card fxFlex="none" fxLayout="column" class="seccion">
                <div fxFlex fxLayout="row" class="encabezado-seccion">
                    <div fxFlex="none" class="icono"><mat-icon>analytics</mat-icon></div>
                    <div fxFlex class="titulo">% Abasto en base a Catalogo Normativo:</div>
                    <div fxFlex="none">
                        <button mat-icon-button>
                            <mat-icon>preview</mat-icon>
                        </button>
                    </div>
                </div>
                <div fxFlex class="contenido-seccion">
                    <table class="tabla-datos">
                        <thead>
                            <tr>
                                <th>Tipo</th>
                                <th>Catalogo</th>
                                <th>Existente</th>
                                <th>Porcentaje</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr *ngIf="!datosTablas.porcentaje_abasto || datosTablas.porcentaje_abasto.lenght == 0"><td colspan="4" class="no-results-found">Sin Datos</td></tr>
                            <tr *ngFor="let registro of datosTablas.porcentaje_abasto">
                                <td>{{registro.tipo}}</td>
                                <td>{{registro.total_claves | number:'1.0-0'}}</td>
                                <td>{{registro.total_claves_existencia | number:'1.0-0'}}</td>
                                <td [ngClass]="{'desabasto':registro.porcentaje<70,'abasto':registro.porcentaje>=70}" >{{registro.porcentaje | number:'1.0-2'}} %</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </mat-card>

            <!--mat-card fxFlex="none" fxLayout="column" class="seccion">
                <div fxFlex="none" fxLayout="row" class="encabezado-seccion">
                    <div fxFlex="none" class="icono"><mat-icon>analytics</mat-icon></div>
                    <div fxFlex class="titulo">Movimientos por Almacen:</div>
                </div>
                <div fxFlex class="contenido-seccion">
                    <table class="tabla-datos">
                        <thead>
                            <tr>
                                <th rowspan="2">Almacén</th>
                                <th rowspan="2">Tipo</th>
                                <th colspan="4">Estatus</th>
                                <th rowspan="2">Total</th>
                            </tr>
                            <tr>
                                <th>Borrador</th>
                                <th>Concluido</th>
                                <th>Cancelado</th>
                                <th>Pendiente</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr *ngIf="!datosTablas.movimientos || datosTablas.movimientos.lenght == 0"><td colspan="7" class="no-results-found">Sin Datos</td></tr>
                            <tr *ngFor="let registro of datosTablas.movimientos">
                                <td>{{registro.almacen}}</td>
                                <td>{{(registro.direccion_movimiento == 'ENT')?'Entrada':'Salida'}}</td>
                                <td>{{registro.total_borrador | number:'1.0-0'}}</td>
                                <td>{{registro.total_concluidos | number:'1.0-0'}}</td>
                                <td>{{registro.total_cancelados | number:'1.0-0'}}</td>
                                <td>{{registro.total_pendiente_recepcion | number:'1.0-0'}}</td>
                                <td>{{registro.total_movimientos | number:'1.0-0'}}</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </mat-card-->

            <mat-card fxFlex="none" fxLayout="column" class="seccion">
                <div fxFlex="none" fxLayout="row" class="encabezado-seccion">
                    <div fxFlex="none" class="icono"><mat-icon>analytics</mat-icon></div>
                    <div fxFlex class="titulo">Recetas y Colectivos Surtidos:</div>
                </div>
                <div fxFlex class="contenido-seccion">
                    <table class="tabla-datos">
                        <thead>
                            <tr>
                                <th rowspan="2">Solicitud</th>
                                <th rowspan="2">Tipo</th>
                                <th colspan="2">Surtidos</th>
                                <th rowspan="2">%</th>
                            </tr>
                            <tr>
                                <th>Total</th>
                                <th>Completos</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr *ngIf="!datosTablas.porcetaje_surtimiento || datosTablas.porcetaje_surtimiento.lenght == 0"><td colspan="5" class="no-results-found">Sin Datos</td></tr>
                            <tr *ngFor="let registro of datosTablas.porcetaje_surtimiento">
                                <td>{{registro.solicitud}}</td>
                                <td>{{registro.tipo||'Sin Especificar'}}</td>
                                <td>{{registro.total_solicitudes | number:'1.0-0'}}</td>
                                <td>{{registro.total_completos | number:'1.0-0'}}</td>
                                <td [ngClass]="{'desabasto':registro.porcentaje<70,'abasto':registro.porcentaje>=70}" >{{registro.porcentaje | number:'1.0-2'}} %</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </mat-card>

            <mat-card fxFlex="none" fxLayout="column" class="seccion">
                <div fxFlex fxLayout="row" class="encabezado-seccion">
                    <div fxFlex="none" class="icono"><mat-icon>analytics</mat-icon></div>
                    <div fxFlex class="titulo">Estado de caducidades:</div>
                </div>
                <div fxFlex class="contenido-seccion">
                    <table class="tabla-datos">
                        <thead>
                            <tr>
                                <th>Estado</th>
                                <th>Total Lotes</th>
                                <th>Total Existencias</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr *ngIf="!datosTablas.articulos_estado_caducidades || datosTablas.articulos_estado_caducidades.lenght == 0"><td colspan="3" class="no-results-found">Sin Datos</td></tr>
                            <tr *ngFor="let registro of datosTablas.articulos_estado_caducidades">
                                <td>{{registro.etiqueta}}</td>
                                <td>{{registro.total_lotes | number:'1.0-0'}}</td>
                                <td>{{registro.total_existencia | number:'1.0-0'}}</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </mat-card>
        </div>

        <mat-card fxFlex fxLayout="column" class="seccion">
            <div fxFlex="none" fxLayout="row" class="encabezado-seccion">
                <div fxFlex="none" class="icono"><mat-icon>table_chart</mat-icon></div>
                <div fxFlex class="titulo">Existencias por Articulo (Normativos):</div>
            </div>
            <div fxFlex class="contenido-seccion" fxLayout="column">
                <div fxFlex="none" fxLayout="row" style="padding-top:4px;">
                    <div fxFlex class="small-search-input">
                        <mat-form-field fxFlex appearance="outline">
                            <input matInput [(ngModel)]="textoFiltro" autocomplete="off" (keyup)="aplicarFiltro($event)" placeholder="Filtrar por clave o nombre">
                        </mat-form-field>
                    </div>
                    <div fxFlex="none">
                        <button mat-button (click)="limpiarFiltro()" [disabled]="!filtroAplicado">
                            <mat-icon>clear</mat-icon>
                        </button>
                    </div>
                </div>
                <mat-divider [inset]="true"></mat-divider>
                <div fxFlex style="overflow: auto;" class="tabla-contenido">
                    <table mat-table [dataSource]="dataSourceArticulos" class="lista-articulos-table" matSort>
                        <ng-container matColumnDef="tipo">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header width="1"> Tipo </th>
                            <td mat-cell *matCellDef="let row" style="white-space: nowrap; padding:0px 5px;">
                                {{row.tipo}}
                            </td>
                        </ng-container>

                        <ng-container matColumnDef="clave">
                            <th mat-header-cell *matHeaderCellDef mat-sort-header width="1"> Clave </th>
                            <td mat-cell *matCellDef="let row" style="white-space: nowrap; padding:0px 5px;">
                                {{row.clave}}
                            </td>
                        </ng-container>
                        
                        <ng-container matColumnDef="descripcion" >
                            <th mat-header-cell *matHeaderCellDef mat-sort-header> Nombre </th>
                            <td mat-cell *matCellDef="let row" class="descripcion"> {{row.descripcion}} </td>
                        </ng-container>

                        <ng-container matColumnDef="existencia" >
                            <th mat-header-cell *matHeaderCellDef mat-sort-header width="1" style="text-align: center; white-space: nowrap;"> Existencias </th>
                            <td mat-cell *matCellDef="let row" width="1" style="white-space: nowrap; text-align: center;"> {{row.existencia||0 | number:'1.0-0'}} </td>
                        </ng-container>
                        
                        <ng-container matColumnDef="noResultsFound">
                            <td mat-footer-cell *matFooterCellDef [attr.colspan]="displayedColumns.length"> No se encontraron articulos </td>
                        </ng-container>
                        
                        <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
                        <tr mat-row class="tabla-row-articulo" *matRowDef="let row; let i = index; columns: displayedColumns;">
                        <tr mat-footer-row *matFooterRowDef="['noResultsFound']" class="no-results-found" [ngClass]="{'hide': dataSourceArticulos && dataSourceArticulos.filteredData.length > 0}"></tr>
                    </table>
                </div>
                <div fxFlex="none" fxLayout="row">
                    <div fxFlex="none" style="padding-top: 10px;">
                    </div>
                    <div fxFlex>
                        <mat-paginator [pageSize]="pageSize" [pageIndex]="currentPage" showFirstLastButtons></mat-paginator>
                    </div>
                </div>
            </div>
        </mat-card>
    </section>
</section>